<?xml version="1.0" encoding="utf-8" ?>
<Patch>

	<!-- ========== Base Grenade Projectile ========== -->

	<Operation Class="PatchOperationReplace">
		<xpath>*/ThingDef[@Name="BaseGrenadeProjectile"]/thingClass</xpath>
		<value>
			<thingClass>CombatExtended.ProjectileCE_Explosive</thingClass>
		</value>
	</Operation>

	<Operation Class="PatchOperationAttributeSet">
		<xpath>*/ThingDef[@Name="BaseGrenadeProjectile"]/projectile</xpath>
		<attribute>Class</attribute>
		<value>CombatExtended.ProjectilePropertiesCE</value>
	</Operation>

	<Operation Class="PatchOperationReplace">
		<xpath>*/ThingDef[@Name="BaseGrenadeProjectile"]/projectile/speed</xpath>
		<value>
			<speed>24</speed>
		</value>
	</Operation>

	<!-- ========== Frag Grenade ========== -->

	<!-- Projectile -->

	<Operation Class="PatchOperationReplace">
		<xpath>*/ThingDef[defName="Proj_GrenadeFrag"]/thingClass</xpath>
		<value>
			<thingClass>CombatExtended.ProjectileCE_Explosive</thingClass>
		</value>
	</Operation>

	<Operation Class="PatchOperationReplace">
		<xpath>*/ThingDef[defName="Proj_GrenadeFrag"]/graphicData/texPath</xpath>
		<value>
			<texPath>Things/Projectile/Grenades/Frag</texPath>
		</value>
	</Operation>

	<Operation Class="PatchOperationReplace">
		<xpath>*/ThingDef[defName="Proj_GrenadeFrag"]/projectile</xpath>
		<value>
			<projectile>
			  <explosionRadius>1.5</explosionRadius>
			  <damageDef>Bomb</damageDef>
			  <damageAmountBase>50</damageAmountBase>
			  <explosionDelay>60</explosionDelay>
			  <dropsCasings>true</dropsCasings>
			  <casingMoteDefname>Mote_GrenadePin</casingMoteDefname>
			</projectile>
		</value>
	</Operation>

	<Operation Class="PatchOperationSequence">
  	<success>Always</success>
  	<operations>
    	<li Class="PatchOperationTest">
      	<xpath>*/ThingDef[defName="Proj_GrenadeFrag"]/comps</xpath>
      	<success>Invert</success>
    	</li>
    	<li Class="PatchOperationAdd">
      	<xpath>*/ThingDef[defName="Proj_GrenadeFrag"]</xpath>
      	<value>
        	<comps />
      	</value>
    	</li>
  	</operations>
	</Operation>

	<Operation Class="PatchOperationAdd">
		<xpath>*/ThingDef[defName="Proj_GrenadeFrag"]/comps</xpath>
		<value>
			<li Class="CombatExtended.CompProperties_ExplosiveCE">
			  <fragments>
			    <Fragment_GrenadeFrag>250</Fragment_GrenadeFrag>
			  </fragments>
			</li>
		</value>
	</Operation>

	<!-- Grenade -->

	<Operation Class="PatchOperationReplace">
		<xpath>*/ThingDef[defName="Weapon_GrenadeFrag"]/label</xpath>
		<value>
			<label>frag grenade</label>
		</value>
	</Operation>

	<Operation Class="PatchOperationReplace">
		<xpath>*/ThingDef[defName="Weapon_GrenadeFrag"]/graphicData</xpath>
		<value>
			<graphicData>
			  <texPath>Things/Ammo/HandGrenades/Frag</texPath>
			  <graphicClass>Graphic_StackCount</graphicClass>
			  <onGroundRandomRotateAngle>0</onGroundRandomRotateAngle>
			</graphicData>
		</value>
	</Operation>

	<Operation Class="PatchOperationAdd">
		<xpath>*/ThingDef[defName="Weapon_GrenadeFrag"]</xpath>
		<value>
			<thingClass>CombatExtended.AmmoThing</thingClass>
			<stackLimit>75</stackLimit>
			<tickerType>Normal</tickerType>
			<resourceReadoutPriority>First</resourceReadoutPriority>
		</value>
	</Operation>

	<Operation Class="PatchOperationAttributeSet">
		<xpath>*/ThingDef[defName="Weapon_GrenadeFrag"]</xpath>
		<attribute>Class</attribute>
		<value>CombatExtended.AmmoDef</value>
	</Operation>

	<Operation Class="PatchOperationAdd">
		<xpath>*/ThingDef[defName="Weapon_GrenadeFrag"]/weaponTags</xpath>
		<value>
			<li>CE_AI_Grenade</li>
			<li>CE_OneHandedWeapon</li>
		</value>
	</Operation>

	<Operation Class="PatchOperationReplace">
		<xpath>*/ThingDef[defName="Weapon_GrenadeFrag"]/statBases/MarketValue</xpath>
		<value>
			<MarketValue>5.25</MarketValue>
		</value>
	</Operation>

	<Operation Class="PatchOperationReplace">
		<xpath>*/ThingDef[defName="Weapon_GrenadeFrag"]/statBases/RangedWeapon_Cooldown</xpath>
		<value>
			<RangedWeapon_Cooldown>1</RangedWeapon_Cooldown>
		</value>
	</Operation>

	<Operation Class="PatchOperationAdd">
		<xpath>*/ThingDef[defName="Weapon_GrenadeFrag"]/statBases</xpath>
		<value>
			<SightsEfficiency>0.15</SightsEfficiency>
		</value>
	</Operation>

	<Operation Class="PatchOperationReplace">
		<xpath>*/ThingDef[defName="Weapon_GrenadeFrag"]/verbs</xpath>
		<value>
			<verbs>
			  <li Class="CombatExtended.VerbPropertiesCE">
			    <label>throw frag grenade</label>
			    <verbClass>CombatExtended.Verb_ShootCEOneUse</verbClass>
			    <hasStandardCommand>true</hasStandardCommand>
			    <range>10.0</range>
			    <warmupTime>0.8</warmupTime>
			    <noiseRadius>4</noiseRadius>
			    <ai_IsBuildingDestroyer>true</ai_IsBuildingDestroyer>
			    <soundCast>ThrowGrenade</soundCast>
			    <targetParams>
			      <canTargetLocations>true</canTargetLocations>
			    </targetParams>
			    <projectileDef>Proj_GrenadeFrag</projectileDef>
			    <onlyManualCast>true</onlyManualCast>
			  </li>
			</verbs>
		</value>
	</Operation>

	<Operation Class="PatchOperationRemove">
		<xpath>*/ThingDef[defName="Weapon_GrenadeFrag"]/smeltProducts</xpath>
	</Operation>

	<Operation Class="PatchOperationSequence">
  	<success>Always</success>
  	<operations>
    	<li Class="PatchOperationTest">
      	<xpath>*/ThingDef[defName="Weapon_GrenadeFrag"]/comps</xpath>
      	<success>Invert</success>
    	</li>
    	<li Class="PatchOperationAdd">
      	<xpath>*/ThingDef[defName="Weapon_GrenadeFrag"]</xpath>
      	<value>
        	<comps />
      	</value>
    	</li>
  	</operations>
	</Operation>

	<Operation Class="PatchOperationAdd">
		<xpath>*/ThingDef[defName="Weapon_GrenadeFrag"]/comps</xpath>
		<value>
			<li Class="CombatExtended.CompProperties_ExplosiveCE">
			  <explosionDamage>40</explosionDamage>
			  <explosionDamageDef>Bomb</explosionDamageDef>
			  <explosionRadius>1.5</explosionRadius>
			  <fragments>
			    <Fragment_GrenadeFrag>250</Fragment_GrenadeFrag>
			  </fragments>
			</li>
		</value>
	</Operation>

	<!-- ========== Molotov cocktail ========== -->

	<!-- Projectile -->

	<Operation Class="PatchOperationReplace">
		<xpath>*/ThingDef[defName="Proj_GrenadeMolotov"]/graphicData/texPath</xpath>
		<value>
			<texPath>Things/Projectile/Grenades/Molotov</texPath>
		</value>
	</Operation>

	<Operation Class="PatchOperationReplace">
		<xpath>*/ThingDef[defName="Proj_GrenadeMolotov"]/projectile</xpath>
		<value>
			<projectile>
			  <explosionRadius>1.5</explosionRadius>
			  <damageDef>Flame</damageDef>
			  <damageAmountBase>30</damageAmountBase>
			  <preExplosionSpawnThingDef>FilthFuel</preExplosionSpawnThingDef>
			  <explosionSpawnChance>1</explosionSpawnChance>
			</projectile>
		</value>
	</Operation>

	<Operation Class="PatchOperationAdd">
		<xpath>*/ThingDef[defName="Proj_GrenadeMolotov"]</xpath>
		<value>
			<thingClass>CombatExtended.Projectile_FireTrail</thingClass>
		</value>
	</Operation>

	<!-- Grenade -->

	<Operation Class="PatchOperationReplace">
		<xpath>*/ThingDef[defName="Weapon_GrenadeMolotov"]/label</xpath>
		<value>
			<label>Molotov cocktail</label>
		</value>
	</Operation>

	<Operation Class="PatchOperationReplace">
		<xpath>*/ThingDef[defName="Weapon_GrenadeMolotov"]/graphicData</xpath>
		<value>
			<graphicData>
			  <texPath>Things/Ammo/HandGrenades/Molotov</texPath>
			  <graphicClass>Graphic_StackCount</graphicClass>
			  <onGroundRandomRotateAngle>0</onGroundRandomRotateAngle>
			</graphicData>
		</value>
	</Operation>

	<Operation Class="PatchOperationAdd">
		<xpath>*/ThingDef[defName="Weapon_GrenadeMolotov"]</xpath>
		<value>
			<thingClass>CombatExtended.AmmoThing</thingClass>
			<stackLimit>75</stackLimit>
			<tickerType>Normal</tickerType>
			<resourceReadoutPriority>First</resourceReadoutPriority>
		</value>
	</Operation>

	<Operation Class="PatchOperationAttributeSet">
		<xpath>*/ThingDef[defName="Weapon_GrenadeMolotov"]</xpath>
		<attribute>Class</attribute>
		<value>CombatExtended.AmmoDef</value>
	</Operation>

	<Operation Class="PatchOperationAdd">
		<xpath>*/ThingDef[defName="Weapon_GrenadeMolotov"]/weaponTags</xpath>
		<value>
			<li>CE_AI_Grenade</li>
			<li>CE_OneHandedWeapon</li>
		</value>
	</Operation>

	<Operation Class="PatchOperationReplace">
		<xpath>*/ThingDef[defName="Weapon_GrenadeMolotov"]/statBases/MarketValue</xpath>
		<value>
			<MarketValue>2.10</MarketValue>
		</value>
	</Operation>

	<Operation Class="PatchOperationReplace">
		<xpath>*/ThingDef[defName="Weapon_GrenadeMolotov"]/statBases/RangedWeapon_Cooldown</xpath>
		<value>
			<RangedWeapon_Cooldown>1</RangedWeapon_Cooldown>
		</value>
	</Operation>

	<Operation Class="PatchOperationAdd">
		<xpath>*/ThingDef[defName="Weapon_GrenadeMolotov"]/statBases</xpath>
		<value>
			<SightsEfficiency>0.15</SightsEfficiency>
		</value>
	</Operation>

	<Operation Class="PatchOperationReplace">
		<xpath>*/ThingDef[defName="Weapon_GrenadeMolotov"]/verbs</xpath>
		<value>
			<verbs>
				<li Class="CombatExtended.VerbPropertiesCE">
				  <label>throw molotov</label>
				  <verbClass>CombatExtended.Verb_ShootCEOneUse</verbClass>
				  <hasStandardCommand>true</hasStandardCommand>
				  <range>10</range>
				  <warmupTime>0.8</warmupTime>
				  <noiseRadius>4</noiseRadius>
				  <ai_IsBuildingDestroyer>true</ai_IsBuildingDestroyer>
				  <ai_IsIncendiary>true</ai_IsIncendiary>
				  <soundCast>ThrowMolotovCocktail</soundCast>
				  <targetParams>
				    <canTargetLocations>true</canTargetLocations>
				  </targetParams>
				  <projectileDef>Proj_GrenadeMolotov</projectileDef>
				  <onlyManualCast>true</onlyManualCast>
				</li>
			</verbs>
		</value>
	</Operation>

	<Operation Class="PatchOperationSequence">
  	<success>Always</success>
  	<operations>
    	<li Class="PatchOperationTest">
      	<xpath>*/ThingDef[defName="Weapon_GrenadeMolotov"]/comps</xpath>
      	<success>Invert</success>
    	</li>
    	<li Class="PatchOperationAdd">
      	<xpath>*/ThingDef[defName="Weapon_GrenadeMolotov"]</xpath>
      	<value>
        	<comps />
      	</value>
    	</li>
  	</operations>
	</Operation>

	<Operation Class="PatchOperationAdd">
		<xpath>*/ThingDef[defName="Weapon_GrenadeMolotov"]/comps</xpath>
		<value>
			<li Class="CombatExtended.CompProperties_ExplosiveCE">
			  <explosionDamage>1</explosionDamage>
			  <explosionDamageDef>Flame</explosionDamageDef>
			  <explosionRadius>0.5</explosionRadius>
			  <preExplosionSpawnThingDef>FilthFuel</preExplosionSpawnThingDef>
			  <explosionSpawnChance>1</explosionSpawnChance>
			</li>
		</value>
	</Operation>

	<!-- ========== EMP Grenade ========== -->

	<!-- Projectile -->

	<Operation Class="PatchOperationReplace">
		<xpath>*/ThingDef[defName="Proj_GrenadeEMP"]/thingClass</xpath>
		<value>
			<thingClass>CombatExtended.ProjectileCE_Explosive</thingClass>
		</value>
	</Operation>

	<Operation Class="PatchOperationReplace">
		<xpath>*/ThingDef[defName="Proj_GrenadeEMP"]/graphicData/texPath</xpath>
		<value>
			<texPath>Things/Projectile/Grenades/EMP</texPath>
		</value>
	</Operation>

	<Operation Class="PatchOperationReplace">
		<xpath>*/ThingDef[defName="Proj_GrenadeEMP"]/projectile</xpath>
		<value>
			<projectile>
			  <explosionRadius>3</explosionRadius>
			  <damageDef>EMP</damageDef>
			  <damageAmountBase>40</damageAmountBase>
			  <explosionDelay>60</explosionDelay>
			  <dropsCasings>true</dropsCasings>
			  <casingMoteDefname>Mote_GrenadePin</casingMoteDefname>
			</projectile>
		</value>
	</Operation>

	<Operation Class="PatchOperationSequence">
  	<success>Always</success>
  	<operations>
    	<li Class="PatchOperationTest">
      	<xpath>*/ThingDef[defName="Proj_GrenadeEMP"]/comps</xpath>
      	<success>Invert</success>
    	</li>
    	<li Class="PatchOperationAdd">
      	<xpath>*/ThingDef[defName="Proj_GrenadeEMP"]</xpath>
      	<value>
        	<comps />
      	</value>
    	</li>
  	</operations>
	</Operation>

	<Operation Class="PatchOperationAdd">
		<xpath>*/ThingDef[defName="Proj_GrenadeEMP"]/comps</xpath>
		<value>
			<li Class="CombatExtended.CompProperties_ExplosiveCE">
			  <explosionDamage>10</explosionDamage>
			  <explosionDamageDef>Electrical</explosionDamageDef>
			  <explosionRadius>4</explosionRadius>
			  <soundExplode>Explosion_Bomb</soundExplode>
			</li>
		</value>
	</Operation>

	<!-- Grenade -->

	<Operation Class="PatchOperationReplace">
		<xpath>*/ThingDef[defName="Weapon_GrenadeEMP"]/label</xpath>
		<value>
			<label>EMP grenade</label>
		</value>
	</Operation>

	<Operation Class="PatchOperationReplace">
		<xpath>*/ThingDef[defName="Weapon_GrenadeEMP"]/graphicData</xpath>
		<value>
			<graphicData>
			  <texPath>Things/Ammo/HandGrenades/EMP</texPath>
			  <graphicClass>Graphic_StackCount</graphicClass>
			  <onGroundRandomRotateAngle>0</onGroundRandomRotateAngle>
			</graphicData>
		</value>
	</Operation>

	<Operation Class="PatchOperationAdd">
		<xpath>*/ThingDef[defName="Weapon_GrenadeEMP"]</xpath>
		<value>
			<thingClass>CombatExtended.AmmoThing</thingClass>
			<stackLimit>75</stackLimit>
			<tickerType>Normal</tickerType>
			<resourceReadoutPriority>First</resourceReadoutPriority>
		</value>
	</Operation>

	<Operation Class="PatchOperationAttributeSet">
		<xpath>*/ThingDef[defName="Weapon_GrenadeEMP"]</xpath>
		<attribute>Class</attribute>
		<value>CombatExtended.AmmoDef</value>
	</Operation>

	<Operation Class="PatchOperationAdd">
		<xpath>*/ThingDef[defName="Weapon_GrenadeFrag"]/weaponTags</xpath>
		<value>
			<li>CE_AI_Grenade</li>
			<li>CE_OneHandedWeapon</li>
		</value>
	</Operation>

	<Operation Class="PatchOperationReplace">
		<xpath>*/ThingDef[defName="Weapon_GrenadeEMP"]/statBases/MarketValue</xpath>
		<value>
			<MarketValue>7.65</MarketValue>
		</value>
	</Operation>

	<Operation Class="PatchOperationReplace">
		<xpath>*/ThingDef[defName="Weapon_GrenadeEMP"]/statBases/RangedWeapon_Cooldown</xpath>
		<value>
			<RangedWeapon_Cooldown>1</RangedWeapon_Cooldown>
		</value>
	</Operation>

	<Operation Class="PatchOperationAdd">
		<xpath>*/ThingDef[defName="Weapon_GrenadeEMP"]/statBases</xpath>
		<value>
			<SightsEfficiency>0.15</SightsEfficiency>
		</value>
	</Operation>

	<Operation Class="PatchOperationReplace">
		<xpath>*/ThingDef[defName="Weapon_GrenadeEMP"]/verbs</xpath>
		<value>
			<verbs>
				<li Class="CombatExtended.VerbPropertiesCE">
				  <label>throw EMP grenade</label>
				  <verbClass>CombatExtended.Verb_ShootCEOneUse</verbClass>
				  <hasStandardCommand>true</hasStandardCommand>
				  <range>10</range>
				  <warmupTime>0.8</warmupTime>
				  <noiseRadius>4</noiseRadius>
				  <ai_IsBuildingDestroyer>false</ai_IsBuildingDestroyer>
				  <soundCast>ThrowGrenade</soundCast>
				  <targetParams>
				    <canTargetLocations>true</canTargetLocations>
				  </targetParams>
				  <projectileDef>Proj_GrenadeEMP</projectileDef>
				  <onlyManualCast>true</onlyManualCast>
				</li>
			</verbs>
		</value>
	</Operation>

	<Operation Class="PatchOperationRemove">
		<xpath>*/ThingDef[defName="Weapon_GrenadeEMP"]/smeltProducts</xpath>
	</Operation>

</Patch>

