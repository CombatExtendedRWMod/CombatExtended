<?xml version="1.0" encoding="utf-8" ?>
<Patch>

    <!-- ========== Doomsday launcher ========== -->

    <!-- Patch both launchers -->

    <Operation Class="PatchOperationRemove">
        <xpath>*/ThingDef[defName="Gun_DoomsdayRocket" or defName="Gun_TripleRocket"]/weaponTags/li[.="Gun"]</xpath>
    </Operation>

    <Operation Class="PatchOperationAttributeSet">
        <xpath>*/ThingDef[defName="Gun_DoomsdayRocket" or defName="Gun_TripleRocket"]</xpath>
        <attribute>ParentName</attribute>
        <value>BaseMakeableGun</value>
    </Operation>

    <Operation Class="PatchOperationRemove">
        <xpath>*/ThingDef[defName="Gun_DoomsdayRocket" or defName="Gun_TripleRocket"]/statBases/MarketValue</xpath>
    </Operation>

    <!-- Patch projectile -->

    <Operation Class="PatchOperationReplace">
        <xpath>*/ThingDef[defName="Bullet_DoomsdayRocket"]/thingClass</xpath>
        <value>
            <thingClass>CombatExtended.ProjectileCE_Explosive</thingClass>
        </value>
    </Operation>

    <Operation Class="PatchOperationReplace">
        <xpath>*/ThingDef[defName="Bullet_DoomsdayRocket"]/projectile</xpath>
        <value>
            <projectile Class="CombatExtended.ProjectilePropertiesCE">
                <damageDef>Bomb</damageDef>
                <damageAmountBase>250</damageAmountBase>
                <explosionRadius>7.8</explosionRadius>
                <speed>100</speed>
            </projectile>
        </value>
    </Operation>

    <Operation Class="PatchOperationSequence">
        <success>Always</success>
        <operations>
            <li Class="PatchOperationTest">
                <xpath>*/ThingDef[defName="Bullet_DoomsdayRocket"]/comps</xpath>
                <success>Invert</success>
            </li>
            <li Class="PatchOperationAdd">
                <xpath>*/ThingDef[defName="Bullet_DoomsdayRocket"]</xpath>
                <value>
                    <comps />
                </value>
            </li>
        </operations>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>*/ThingDef[defName="Bullet_DoomsdayRocket"]/comps</xpath>
        <value>
            <li Class="CombatExtended.CompProperties_ExplosiveCE">
                <fragSpeedFactor>1</fragSpeedFactor>
                <fragments>
                    <Fragment_RocketFrag>400</Fragment_RocketFrag>
                </fragments>
            </li>
        </value>
    </Operation>

    <!-- Patch stats -->

    <Operation Class="CombatExtended.PatchOperationMakeGunCECompatible">
        <defName>Gun_DoomsdayRocket</defName>
        <statBases>
            <Mass>20.00</Mass>
            <RangedWeapon_Cooldown>1.5</RangedWeapon_Cooldown>
            <SightsEfficiency>2.24</SightsEfficiency>
            <ShotSpread>0.2</ShotSpread>
            <SwayFactor>3.24</SwayFactor>
            <Bulk>13.0</Bulk>
            <WorkToMake>49500</WorkToMake>
        </statBases>
        <costList>
            <Steel>125</Steel>
            <Component>8</Component>
            <FSX>5</FSX>
        </costList>
        <Properties>
            <verbClass>CombatExtended.Verb_ShootCEOneUse</verbClass>
            <hasStandardCommand>true</hasStandardCommand>
            <defaultProjectile>Bullet_DoomsdayRocket</defaultProjectile>
            <forcedMissRadius>0.0</forcedMissRadius>
            <warmupTime>2.1</warmupTime>
            <range>48</range>
            <burstShotCount>1</burstShotCount>
            <soundCast>InfernoCannon_Fire</soundCast>
            <soundCastTail>GunTail_Heavy</soundCastTail>
            <onlyManualCast>true</onlyManualCast>
            <targetParams>
                <canTargetLocations>true</canTargetLocations>
            </targetParams>
            <muzzleFlashScale>14</muzzleFlashScale>
        </Properties>
        <FireModes>
            <aiAimMode>AimedShot</aiAimMode>
        </FireModes>
        <weaponTags>
            <li>CE_AI_Launcher</li>
        </weaponTags>
        <researchPrerequisite>CE_AdvancedLaunchers</researchPrerequisite>
    </Operation>

    <Operation Class="PatchOperationReplace">
        <xpath>*/ThingDef[defName="Gun_DoomsdayRocket"]/tools</xpath>
        <value>
            <tools>
                <li Class="CombatExtended.ToolCE">
                    <label>barrel</label>
                    <capacities>
                        <li>Blunt</li>
                    </capacities>
                    <power>10</power>
                    <cooldownTime>1.9</cooldownTime>
                    <armorPenetration>0.118</armorPenetration>
                    <linkedBodyPartsGroup>Barrel</linkedBodyPartsGroup>
                </li>
            </tools>
        </value>
    </Operation>

    <!-- ========== Triple rocket launcher ========== -->

    <!-- Patch projectile -->

    <Operation Class="PatchOperationReplace">
        <xpath>*/ThingDef[defName="Bullet_Rocket"]/thingClass</xpath>
        <value>
            <thingClass>CombatExtended.ProjectileCE_Explosive</thingClass>
        </value>
    </Operation>

    <Operation Class="PatchOperationReplace">
        <xpath>*/ThingDef[defName="Bullet_Rocket"]/projectile</xpath>
        <value>
            <projectile Class="CombatExtended.ProjectilePropertiesCE">
                <damageDef>Bomb</damageDef>
                <damageAmountBase>180</damageAmountBase>
                <explosionRadius>3.0</explosionRadius>
                <speed>100</speed>
            </projectile>
        </value>
    </Operation>

    <Operation Class="PatchOperationSequence">
        <success>Always</success>
        <operations>
            <li Class="PatchOperationTest">
                <xpath>*/ThingDef[defName="Bullet_Rocket"]/comps</xpath>
                <success>Invert</success>
            </li>
            <li Class="PatchOperationAdd">
                <xpath>*/ThingDef[defName="Bullet_Rocket"]</xpath>
                <value>
                    <comps />
                </value>
            </li>
        </operations>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>*/ThingDef[defName="Bullet_Rocket"]/comps</xpath>
        <value>
            <li Class="CombatExtended.CompProperties_ExplosiveCE">
                <fragSpeedFactor>1</fragSpeedFactor>
                <fragments>
                    <Fragment_RocketFrag>150</Fragment_RocketFrag>
                </fragments>
            </li>
        </value>
    </Operation>

    <!-- Patch stats -->

    <Operation Class="CombatExtended.PatchOperationMakeGunCECompatible">
        <defName>Gun_TripleRocket</defName>
        <statBases>
            <Mass>12.00</Mass>
            <RangedWeapon_Cooldown>1.5</RangedWeapon_Cooldown>
            <SightsEfficiency>1</SightsEfficiency>
            <ShotSpread>0.2</ShotSpread>
            <SwayFactor>2.20</SwayFactor>
            <Bulk>13.00</Bulk>
            <WorkToMake>43000</WorkToMake>
        </statBases>
        <costList>
            <Steel>90</Steel>
            <Component>7</Component>
            <FSX>3</FSX>
        </costList>
        <Properties>
            <verbClass>CombatExtended.Verb_ShootCEOneUse</verbClass>
            <hasStandardCommand>true</hasStandardCommand>
            <defaultProjectile>Bullet_Rocket</defaultProjectile>
            <forcedMissRadius>2.0</forcedMissRadius>
            <warmupTime>1.9</warmupTime>
            <range>40</range>
            <ticksBetweenBurstShots>20</ticksBetweenBurstShots>
            <burstShotCount>3</burstShotCount>
            <soundCast>InfernoCannon_Fire</soundCast>
            <soundCastTail>GunTail_Heavy</soundCastTail>
            <onlyManualCast>true</onlyManualCast>
            <stopBurstWithoutLos>false</stopBurstWithoutLos>
            <targetParams>
                <canTargetLocations>true</canTargetLocations>
            </targetParams>
            <muzzleFlashScale>14</muzzleFlashScale>
        </Properties>
        <FireModes>
            <aiAimMode>AimedShot</aiAimMode>
            <noSingleShot>true</noSingleShot>
        </FireModes>
        <weaponTags>
            <li>CE_AI_Launcher</li>
        </weaponTags>
        <researchPrerequisite>CE_AdvancedLaunchers</researchPrerequisite>
    </Operation>

    <Operation Class="PatchOperationReplace">
        <xpath>*/ThingDef[defName="Gun_TripleRocket"]/tools</xpath>
        <value>
            <tools>
                <li Class="CombatExtended.ToolCE">
                    <label>barrel</label>
                    <capacities>
                        <li>Blunt</li>
                    </capacities>
                    <power>10</power>
                    <cooldownTime>1.9</cooldownTime>
                    <armorPenetration>0.118</armorPenetration>
                    <linkedBodyPartsGroup>Barrel</linkedBodyPartsGroup>
                </li>
            </tools>
        </value>
    </Operation>

</Patch>